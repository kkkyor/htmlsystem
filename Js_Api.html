// ============================================================================
  // [Js_Api.html]
  // ============================================================================

  // ----------------------------------------------------------------------------
  // 4-1. ê³ ê° ëª©ë¡ ì¡°íšŒ
  // ----------------------------------------------------------------------------
  async function fetchCustomers(isNew = false) {
    if(isNew) {
      currentOffset = 0;
      const getSafeVal = (id) => { const el = document.getElementById(id); return el ? el.value : ''; };
      currentFilters = {
        searchTerm: getSafeVal('filterSearchTerm'),
        dbType: getSafeVal('filterDbType'),
        status: getSafeVal('filterCustomerStatus'),
        dateFrom: getSafeVal('filterAssignmentDateFrom'),
        dateTo: getSafeVal('filterAssignmentDateTo')
      };
    } else {
      currentOffset += PAGE_SIZE;
    }

    showLoader();
    try {
      const isLastLogSort = (currentSortColumn === 'last_log_date');
      const nullsFirstOption = isLastLogSort ? true : false;

      let query = supabase.from('customers').select('*', { count: 'exact' })
        .range(currentOffset, currentOffset + PAGE_SIZE - 1)
        .order(currentSortColumn, { ascending: currentSortAscending, nullsFirst: nullsFirstOption });

      if (currentFilters.searchTerm) {
         const term = currentFilters.searchTerm;
         const cleanTerm = term.replace(/-/g, ''); 
         const searchConditions = [
            `customer_name.ilike.%${term}%`,
            `customer_phone.ilike.%${cleanTerm}%`, 
            `customer_phone.ilike.%${term}%`,
            `customer_memo.ilike.%${term}%`,
            `interested_car_model.ilike.%${term}%`
         ].join(',');
         query = query.or(searchConditions);
      }
      
      if(currentFilters.status) query = query.eq('customer_status', currentFilters.status);
      if(currentFilters.dbType) query = query.eq('db_type', currentFilters.dbType);
      if(currentFilters.dateFrom) query = query.gte('assignment_date', currentFilters.dateFrom);
      if(currentFilters.dateTo) {
        const d = new Date(currentFilters.dateTo); d.setDate(d.getDate()+1);
        query = query.lt('assignment_date', d.toISOString());
      }

      const { data, count, error } = await query;
      if(error) throw error;
      
      totalCustomerCount = count;
      displayAssignedCustomers(data.map(toUiData), isNew);
    } catch(e) {
      handleFailure(e);
    } finally {
      hideLoader();
    }
  }

  // ----------------------------------------------------------------------------
  // 4-2. ê³„ì•½ ëª©ë¡ ì¡°íšŒ
  // ----------------------------------------------------------------------------
  async function fetchGlobalContracts(isNew = false) {
    if (isNew) {
      currentContractOffset = 0;
    } else {
      currentContractOffset += PAGE_SIZE;
    }

    showLoader();
    try {
      let query = supabase
        .from('contracts')
        .select('*, customers!inner(customer_name, customer_phone, assigned_to)')
        .eq('customers.assigned_to', currentUserName)
        .order('contract_date', { ascending: false });

      const statusEl = document.getElementById('filterContractStatus');
      const termEl = document.getElementById('contractSearchTerm');
      const dateEl = document.getElementById('filterContractDateFrom');
      
      if (statusEl && statusEl.value) query = query.eq('contract_status', statusEl.value);
      if (termEl && termEl.value) query = query.ilike('contract_car_model', `%${termEl.value}%`);
      if (dateEl && dateEl.value) query = query.gte('contract_date', dateEl.value);

      const { data, count, error } = await query; 
      if (error) throw error;

      if (isNew) {
          renderGlobalContracts(data, true); 
      } else {
          renderGlobalContracts(data, false);
      }
    } catch (e) {
      handleFailure(e);
    } finally {
      hideLoader();
    }
  }

  // ----------------------------------------------------------------------------
  // 4-3. ë‹¨ì¼ ê³ ê° ìƒì„¸ ì¡°íšŒ
  // ----------------------------------------------------------------------------
  async function selectCustomer(id) {
    showLoader();
    try {
      const { data: cust, error: e1 } = await supabase.from('customers').select('*').eq('assignment_id', id).maybeSingle();
      if (e1) throw e1;
      if (!cust) throw new Error("ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³ ê°ì…ë‹ˆë‹¤.");
      
      const { data: logs, error: e2 } = await supabase.from('consultation_logs').select('*').eq('assignment_id', id).order('log_timestamp', {ascending:false});
      if(e2) throw e2;

      const { data: contracts, error: e3 } = await supabase.from('contracts')
        .select('*, customers(customer_name)') 
        .or(`assignment_id.eq.${id},consultant_id.eq.${id}`)
        .order('contract_date', {ascending:false});
      if(e3) throw e3;

      document.getElementById('listPanel').classList.add('hidden');
      if(document.getElementById('contractListPanel')) document.getElementById('contractListPanel').classList.add('hidden');
      const contractPanel = document.getElementById('contractDetailPanel');
      if(contractPanel) contractPanel.classList.add('hidden');

      document.getElementById('customerDetailPanel').classList.remove('hidden');

      displayAssignmentDetails({ assignment: toUiData(cust) });
      
      renderLogs(logs.map(l => ({ 
          logId: l.log_id, 
          logTimestamp: l.log_timestamp, 
          logContent: l.log_content,
          userName: l.user_name 
      })));
      renderContracts(contracts);

    } catch(e) {
      handleFailure(e);
    } finally {
      hideLoader();
    }
  }

  // ----------------------------------------------------------------------------
  // 4-4. ìƒë‹´ ë¡œê·¸ ê´€ë¦¬
  // ----------------------------------------------------------------------------
  async function deleteLog(logId) {
    if (!confirm("ì •ë§ ì´ ìƒë‹´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    showLoader();
    const { error } = await supabase.from('consultation_logs').delete().eq('log_id', logId);
    hideLoader();
    if (error) alert("ì‚­ì œ ì‹¤íŒ¨: " + error.message);
    else if(currentAssignmentId) selectCustomer(currentAssignmentId);
  }

  async function editLog(logId, btnElement) {
    const contentDiv = document.getElementById(`content-${logId}`);
    const currentContent = contentDiv.textContent;
    const card = btnElement.closest('.log-entry-card');
    const actionsDiv = btnElement.closest('.log-actions');
    if (card.querySelector('textarea')) return;

    contentDiv.style.display = 'none';
    actionsDiv.style.display = 'none';

    const editorDiv = document.createElement('div');
    editorDiv.innerHTML = `
        <textarea style="width:100%; height:100px; margin:5px 0; border:1px solid #ccc; padding:5px;">${currentContent}</textarea>
        <div style="text-align:right; gap:5px; display:flex; justify-content:flex-end;">
            <button id="save-${logId}" style="padding:4px 10px; font-size:0.8rem;">ì €ì¥</button>
            <button id="cancel-${logId}" class="secondary" style="padding:4px 10px; font-size:0.8rem;">ì·¨ì†Œ</button>
        </div>
    `;
    card.appendChild(editorDiv);

    document.getElementById(`save-${logId}`).onclick = async () => {
        const newText = editorDiv.querySelector('textarea').value;
        if (!newText.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        showLoader();
        const { error } = await supabase.from('consultation_logs').update({ log_content: newText }).eq('log_id', logId);
        hideLoader();
        if (error) alert("ìˆ˜ì • ì‹¤íŒ¨: " + error.message);
        else if(currentAssignmentId) selectCustomer(currentAssignmentId);
    };

    document.getElementById(`cancel-${logId}`).onclick = () => {
        editorDiv.remove();
        contentDiv.style.display = 'block';
        actionsDiv.style.display = 'flex';
    };
  }

  // ----------------------------------------------------------------------------
  // 4-5. Cloud Run AI ë¶„ì„
  // ----------------------------------------------------------------------------
  const CLOUD_RUN_BASE_URL = "https://rental-analyzer-812042135518.asia-northeast3.run.app"; 

  function onAnalysisSuccess(response) {
    hideLoader();
    if (!response.success) {
      alert("âŒ ë¶„ì„ ì‹¤íŒ¨:\n" + response.error);
      return;
    }
    let data = response.data;
    if (Array.isArray(data)) data = data[0];
    
    if (!data || Object.keys(data).length === 0) {
        alert("âš ï¸ ë¶„ì„ì€ ì„±ê³µí–ˆìœ¼ë‚˜ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
        return;
    }
    alert("âœ… ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\në‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");

    const smartFill = (id, newVal) => {
      const el = document.getElementById(id);
      if (!el) return;
      if (newVal === undefined || newVal === null || String(newVal).trim() === "") return;

      const currentVal = el.value.trim();
      const isPlaceholder = currentVal === '' || currentVal.includes('í™•ì¸') || currentVal.includes('ë¯¸ì •') || currentVal.includes('ì¶”ì •');
      if (!isPlaceholder) return; 

      const normalizeStr = (str) => String(str).normalize("NFC").replace(/\s+/g, '').toLowerCase();
      const cleanNewVal = normalizeStr(newVal);

      if (el.tagName.toUpperCase() === 'SELECT') {
          let bestMatch = "";
          for (let i = 0; i < el.options.length; i++) {
              const optVal = el.options[i].value;
              const optText = el.options[i].text;
              const cleanOptVal = normalizeStr(optVal);
              const cleanOptText = normalizeStr(optText);

              if (cleanOptVal === cleanNewVal || cleanOptText === cleanNewVal ||
                 (cleanOptVal.length > 0 && cleanNewVal.includes(cleanOptVal)) || 
                 (cleanOptText.length > 0 && cleanNewVal.includes(cleanOptText))) {
                  bestMatch = optVal;
                  break;
              }
          }
          if (bestMatch) {
              el.value = bestMatch; 
          } else {
              let optExists = false;
              for(let j=0; j<el.options.length; j++) {
                  if(el.options[j].value == newVal) { optExists = true; break; }
              }
              if (!optExists) {
                  const newOpt = document.createElement('option');
                  newOpt.value = newVal;
                  newOpt.text = newVal; 
                  newOpt.style.color = "blue"; 
                  el.add(newOpt);
              }
              el.value = newVal;
          }
          highlight(el);
      } else {
          el.value = newVal;
          highlight(el);
      }
    };

    const highlight = (el) => {
        el.style.backgroundColor = "#d1e7dd"; 
        setTimeout(() => el.style.backgroundColor = "", 3000);
    };

    smartFill('customerType', data.customer_type);
    smartFill('gender', data.gender);
    smartFill('ageGroup', data.age_group);
    smartFill('addressCity', data.address_city);
    smartFill('incomeType', data.income_type);
    smartFill('creditInfo', data.credit_info);
    smartFill('occupation', data.occupation);
    
    smartFill('interestedCarModel', data.interested_car_model);
    smartFill('comparisonCarModel', data.comparison_car_model);
    smartFill('ownedCarModel', data.owned_car_model);
    smartFill('carUsage', data.car_usage);
    smartFill('drivingDistance', data.driving_distance);
    smartFill('driverScope', data.driver_scope);
    smartFill('expectedContractTiming', data.expected_contract_timing);
    smartFill('desiredContractTerm', data.desired_contract_term);
    smartFill('desiredInitialCostType', data.desired_initial_cost_type);
    smartFill('maintenanceServiceLevel', data.maintenance_service_level);

    if (data.customer_phone) {
        const formatted = typeof formatPhoneNumber_Client === 'function' ? formatPhoneNumber_Client(data.customer_phone) : data.customer_phone;
        smartFill('detailCustomerPhoneNumber', formatted);
    }

    const memoEl = document.getElementById('customerMemo');
    if (memoEl && data.summary) {
      const currentMemo = memoEl.value;
      if (!currentMemo.includes(data.summary)) {
          const prefix = currentMemo ? " | " : "";
          memoEl.value += prefix + "[AIìš”ì•½] " + data.summary;
          highlight(memoEl);
      }
    }

    const logEl = document.getElementById('newLogContent');
    if (logEl && data.summary) {
      logEl.value = `[ğŸ™ï¸ ë…¹ìŒ ë¶„ì„ ê²°ê³¼]\n\nğŸ“„ í•µì‹¬ìš”ì•½:\n${data.summary}\n\nğŸ“ ìƒì„¸ë‚´ìš©:\n${data.details || '(ë‚´ìš© ì—†ìŒ)'}`;
      highlight(logEl);
      const addLogBtn = document.getElementById('addLogBtn');
      if(addLogBtn) addLogBtn.focus();
    }
  }

  // â˜… [ê³µí†µ í•¨ìˆ˜] íŒŒì¼ ì—…ë¡œë“œ ë° AI ë¶„ì„ ìš”ì²­
  async function uploadAndAnalyzeFile(file, analysisType) {
    if (!file) return null;
    
    const fileId = `upload_${Date.now()}_${Math.floor(Math.random()*1000)}`;
    const CHUNK_SIZE = 10 * 1024 * 1024; 
    const totalChunks = Math.ceil(file.size / CHUNK_SIZE);
    
    for (let i = 0; i < totalChunks; i++) {
        const start = i * CHUNK_SIZE;
        const end = Math.min(file.size, start + CHUNK_SIZE);
        const chunk = file.slice(start, end);
        
        const percent = Math.round(((i) / totalChunks) * 100);
        setStatusMessage(`ğŸ“¡ íŒŒì¼ ì „ì†¡ ì¤‘... ${percent}%`);

        const formData = new FormData();
        formData.append("file", chunk);
        formData.append("file_id", fileId);
        formData.append("chunk_index", i);

        const res = await fetch(`${CLOUD_RUN_BASE_URL}/upload-chunk`, {
            method: "POST",
            body: formData
        });
        
        if (!res.ok) throw new Error(`Chunk ${i} upload failed`);
    }

    setStatusMessage("ğŸ¤– AIê°€ ë¬¸ì„œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...");
    
    let mimeType = file.type;
    if (!mimeType) mimeType = 'application/octet-stream';

    const finalForm = new FormData();
    finalForm.append("file_id", fileId);
    finalForm.append("total_chunks", totalChunks);
    finalForm.append("file_name", file.name);
    finalForm.append("mime_type", mimeType);
    finalForm.append("analysis_type", analysisType); 

    const analyzeRes = await fetch(`${CLOUD_RUN_BASE_URL}/analyze-chunked`, {
        method: "POST",
        body: finalForm
    });

    const result = await analyzeRes.json();
    if (!result.success) throw new Error(result.error);
    
    return result.data;
  }

  function setupContractAnalysisListener() {
     // ì´ë²¤íŠ¸ëŠ” Js_Ui.htmlì—ì„œ ì²˜ë¦¬í•¨
  }

  // â˜… [ê³„ì•½ ì €ì¥ ë° êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡ ë¡œì§]
  async function saveNewContractLogic() {
    const date = document.getElementById('modalContractDate').value;
    const car = document.getElementById('modalContractCarModel').value;
    if(!date || !car) return alert('ê³„ì•½ì¼ê³¼ ì°¨ì¢…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');

    const isProxy = document.getElementById('isDifferentContractor').checked;
    const realName = document.getElementById('realContractorName').value.trim();
    const realPhone = document.getElementById('realContractorPhone').value.trim().replace(/\D/g, "");
    const relation = document.getElementById('contractorRelation').value;

    if(isProxy && (!realName || !realPhone)) return alert('ì‹¤ê³„ì•½ì ì´ë¦„ê³¼ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

    showLoader();
    try {
        let targetAssignmentId = currentAssignmentId;
        let actualContractorId = currentAssignmentId;
        let consultantId = currentAssignmentId;
        let relationshipVal = 'ë³¸ì¸';
        const nowISO = new Date().toISOString();

        if (isProxy) {
            relationshipVal = relation;
            let memoSuffix = (relation !== 'ì§€ì¸/ì†Œê°œ') ? "íƒ€ì¸ëª…ì˜ ì§„í–‰ê±´" : "ì†Œê°œê±´";
            const autoMemo = `[ìë™ìƒì„±] ${document.getElementById('detailCustomerNameText').textContent}ë‹˜ì˜ ${memoSuffix}`;

            const { data: existUser } = await supabase.from('customers').select('assignment_id').eq('customer_phone', realPhone).maybeSingle();
            if (existUser) {
                targetAssignmentId = existUser.assignment_id;
                actualContractorId = existUser.assignment_id;
                await supabase.from('customers').update({ last_log_date: nowISO, updated_at: nowISO }).eq('assignment_id', existUser.assignment_id);
            } else {
                const ts = Date.now();
                const newId = "A_" + ts;
                await supabase.from('customers').insert([{
                    assignment_id: newId,
                    customer_id: "C_" + ts,
                    customer_name: realName,
                    customer_phone: realPhone,
                    assigned_to: currentUserName,
                    owner_email: currentUserEmail,
                    customer_status: 'ê³„ì•½ ì™„ë£Œ',
                    lead_source: relationshipVal,
                    customer_memo: autoMemo,
                    last_log_date: nowISO,
                    updated_at: nowISO
                }]);
                targetAssignmentId = newId;
                actualContractorId = newId;
            }
        }

        // [ë°ì´í„° ì¤€ë¹„] êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡ì„ ìœ„í•´ ê°ì²´ì— ë‹´ìŒ
        const contractData = {
            contract_id: "CN_" + Date.now(),
            assignment_id: targetAssignmentId, 
            actual_contractor_id: actualContractorId,
            consultant_id: consultantId,
            relationship: relationshipVal,
            contract_status: 'ì§„í–‰ì¤‘',
            contract_date: date,
            contract_car_model: car,
            contract_amount: document.getElementById('modalContractAmount').value || 0,
            contract_term: document.getElementById('modalContractTerm').value,
            contract_summary: document.getElementById('modalContractSummary').value,
            
            product_name: document.getElementById('modalProductName').value,
            exterior_color: document.getElementById('modalExteriorColor').value,
            interior_color: document.getElementById('modalInteriorColor').value,
            car_price: document.getElementById('modalCarPrice').value ? document.getElementById('modalCarPrice').value.replace(/,/g,'') : 0,
            agreed_mileage: document.getElementById('modalAgreedMileage').value,
            acquisition_price: document.getElementById('modalAcquisitionPrice').value,
            deposit_info: document.getElementById('modalDepositInfo').value,
            penalty_rate: document.getElementById('modalPenaltyRate').value,
            maintenance_product: document.getElementById('modalMaintenanceProduct').value,
            
            // [ì¶”ê°€ëœ í•„ë“œ]
            commission: document.getElementById('modalCommission').value || 0,
            input_date: document.getElementById('modalInputDate').value,
            approval_number: document.getElementById('modalApprovalNumber').value,
            contract_number: document.getElementById('modalContractNumber').value,
            contract_receipt_date: document.getElementById('modalContractReceiptDate').value,
            lead_source: document.getElementById('modalLeadSource').value
        };

        // 1. Supabase ì €ì¥
        const { error } = await supabase.from('contracts').insert([contractData]);
        if(error) throw error;


        // =====================================================================================================================
        // [ìˆ˜ì • ì˜ì—­ 1] êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ê¸°ëŠ¥ ë¹„í™œì„±í™” (ì£¼ì„ ì²˜ë¦¬)
        // =======================================================================================================================
        /* // í…ŒìŠ¤íŠ¸ ê¸°ê°„ ë™ì•ˆ ì‹œíŠ¸ ì €ì¥ì„ ë§‰ê¸° ìœ„í•´ ì£¼ì„ ì²˜ë¦¬í•¨
        // 2. êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë°ì´í„° ì „ì†¡ (ì„œë²„ ì‚¬ì´ë“œ í•¨ìˆ˜ í˜¸ì¶œ)
        const customerName = document.getElementById('detailCustomerNameText').textContent; // Bì—´
        const sheetData = {
            name: isProxy ? `${realName}(${customerName})` : customerName, // ì‹¤ê³„ì•½ì(ìƒë‹´ì) í˜•ì‹
            car: contractData.contract_car_model, // Cì—´
            manager: currentUserName, // Dì—´
            receiptDate: contractData.contract_receipt_date, // Eì—´
            leadSource: contractData.lead_source // Gì—´
        };

        // ë¹„ë™ê¸°ë¡œ ì‹œíŠ¸ ì €ì¥ ìš”ì²­ (ì‚¬ìš©ìì—ê²ŒëŠ” ë°”ë¡œ ì„±ê³µ ë©”ì‹œì§€ ë³´ì—¬ì¤Œ)
        google.script.run
            .withFailureHandler((err) => console.error("Sheet Export Error:", err))
            .appendContractToSheet(sheetData);
        */
        // =======================================================================================================================


        hideLoader();



        // =======================================================================================================================
        // [ìˆ˜ì • ì˜ì—­ 2] ë©”ì¼ ë°œì†¡ íŒì—… ê¸°ëŠ¥ ë¹„í™œì„±í™” (ì£¼ì„ ì²˜ë¦¬)
        // =======================================================================================================================
        /*
        // í…ŒìŠ¤íŠ¸ ê¸°ê°„ ë™ì•ˆ ë©”ì¼ ë°œì†¡ íŒì—…ì„ ë„ìš°ì§€ ì•ŠìŒ
        if (confirm("ê³„ì•½ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nğŸ“§ ë°”ë¡œ ë©”ì¼ ì‘ì„± ì°½ì„ ë„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            openMailPopup(contractData, isProxy ? realName : customerName);
        }
        */
        alert("âœ… ê³„ì•½ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ì‹œíŠ¸ ì €ì¥ ë° ë©”ì¼ ë°œì†¡ ìƒëµë¨)");
        // ==================================================================================================================

        closeAddContractScreen(); 
        selectCustomer(currentAssignmentId); 
        
    } catch(e) { 
        handleFailure(e); 
    }
  }

  // â˜… [ì‹ ê·œ] ë©”ì¼ ë°œì†¡ íŒì—… URL ìƒì„± ë° ì—´ê¸°
  function openMailPopup(data, contractorName) {
    // 1. ë©”ì¼ ì œëª© ë° ë³¸ë¬¸ êµ¬ì„± (êµ¬ê¸€ ì‹œíŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ì„ JSë¡œ êµ¬í˜„)
    const subjectParts = [
       // ìˆœì„œ: ì²´í¬ë°•ìŠ¤(x), ì´ë¦„, ì°¨ì¢…, ë‹´ë‹¹ì, ê³„ì•½ì ‘ìˆ˜, (ê³µë€), ìœ ì…ê²½ë¡œ, (ê³µë€), ê³„ì•½ì¼, ì´ˆê¸°ë¹„ìš©...
       // êµ¬ê¸€ ì‹œíŠ¸ì˜ ì—´ ìˆœì„œì™€ ë©”ì¼ ì œëª© êµ¬ì„± ë¡œì§ì„ ì°¸ê³ í•˜ì—¬ ì¡°í•©
       contractorName, 
       data.contract_car_model, 
       currentUserName, 
       data.contract_receipt_date, 
       data.lead_source, 
       data.contract_date,
       data.deposit_info, // ì´ˆê¸°ë¹„ìš©(ë³´ì¦ê¸ˆ/ì„ ë‚©ê¸ˆ)
       // ... í•„ìš”í•œ í•­ëª© ì¶”ê°€
    ];
    
    // ë¹ˆ ê°’ ì œê±° ë° êµ¬ë¶„ìë¡œ ì—°ê²°
    const mailSubject = subjectParts.filter(v => v).join(' / ');

    // 2. ë©”ì¼ ë³¸ë¬¸ êµ¬ì„± (CONFIG.MAIL_CONFIG ì°¸ê³ )
    const bodyTemplate = [
      `ê³„ì•½ì : ${contractorName}`,
      `ê³„ì•½ì¼ì : ${data.contract_date}`,
      `ìˆ˜ìˆ˜ë£Œ : ${Number(data.commission).toLocaleString()}ì›`,
      `ê³„ì•½ê¸°ê°„ : ${data.contract_term}ê°œì›”`,
      `ì°¨ëŸ‰ê°€(ì·¨ë“ì›ê°€) : ${Number(data.car_price).toLocaleString()}ì›`,
      `ì›”ì´ìš©ë£Œ : ${Number(data.contract_amount).toLocaleString()}ì›`,
      `ë³´ì¦ê¸ˆ : ${data.deposit_info}`,
      `íˆ¬ì…ì¼ì : ${data.input_date}`,
      `ìŠ¹ì¸ë²ˆí˜¸ : ${data.approval_number}`,
      `ê³„ì•½ë²ˆí˜¸ : ${data.contract_number}`,
      "",
      "\n\n========== ê³„ì•½ì„œ íŒŒì¼ ê¼­ ì²¨ë¶€ í™•ì¸ë¶€íƒë“œë¦½ë‹ˆë‹¤ ==========\n",
      "",
      // ì¶”ê°€ ë³¸ë¬¸ í…ìŠ¤íŠ¸ (êµ¬ê¸€ ì‹œíŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© ë³µì‚¬)
      `1ï¸âƒ£ ê³ ê° ìƒí™©
ğŸ‘‰ ì™œ ì°¨ë¥¼ ì•Œì•„ë³´ì…¨ëŠ”ì§€ / ì–´ë–¤ ê³ ë¯¼ì´ ìˆì—ˆëŠ”ì§€
(ì˜ˆ: ì²« ì°¨, ì—…ë¬´ìš©, ì´ˆê¸°ë¹„ìš© ë¶€ë‹´, ì‹ ìš©ë¬¸ì œ, ë³´í—˜/ì •ë¹„ ê±±ì • ë“±)


____________________________________________________________

2ï¸âƒ£ ì°¨ëŸ‰ & ìƒí’ˆ ì„ íƒ ì´ìœ 
ğŸ‘‰ ì–´ë–¤ ì°¨ëŸ‰ì„ ì„ íƒí–ˆê³ , ì–´ë–¤ ìƒí’ˆìœ¼ë¡œ ì§„í–‰í–ˆëŠ”ì§€
(ì˜ˆ: ì˜ë Œí†  í•˜ì´ë¸Œë¦¬ë“œ ì¸ìˆ˜í˜• / ìœ„ì•½ê¸ˆ ë¶€ë‹´ ì—†ìŒ / ì •ë¹„ í¬í•¨ì´ë¼ ì„ íƒ)


____________________________________________________________

3ï¸âƒ£ ì§„í–‰ ë° ì¶œê³  ê³¼ì •
ğŸ‘‰ ìŠ¹ì¸Â·ê³„ì•½Â·ì¶œê³  ê³¼ì • ì¤‘ ê³ ê°ì´ í¸ë¦¬í•´í•˜ê±°ë‚˜ ë§Œì¡±í•œ ë¶€ë¶„
(ì˜ˆ: ì„œë¥˜ ê°„ë‹¨ / ë³´ì¦ê¸ˆ ì—†ìŒ / ë¹ ë¥¸ ì¶œê³  / ì¹œì ˆí•œ ì•ˆë‚´ ë“±)


____________________________________________________________

4ï¸âƒ£ ê³ ê° ë°˜ì‘ & ë§Œì¡± í¬ì¸íŠ¸
ğŸ‘‰ ê³ ê°ì´ ì‹¤ì œë¡œ í‘œí˜„í•œ ë§Œì¡±ë„ë‚˜ í•œë§ˆë””
(ì˜ˆ: â€œì´ë ‡ê²Œ ì‰½ê²Œ ë  ì¤„ ëª°ëë‹¤â€, â€œì •ë¹„ ê±±ì • ì—†ì–´ ì¢‹ë‹¤â€)


____________________________________________________________

5ï¸âƒ£ ë™ë£Œ ê°ì‚¬ í•œ ì¤„
ğŸ‘‰ ê³„ì•½ ê³¼ì •ì—ì„œ ë„ì›€ ì¤€ ë™ë£Œë‚˜ íŒ€ì—ê²Œ ê°ì‚¬ í‘œí˜„
(ì˜ˆ: â€œìŠ¹ì¸ê³¼ì • ë„ì™€ì£¼ì‹  ã…‡ã…‡íŒ€ì¥ë‹˜ ê°ì‚¬í•©ë‹ˆë‹¤!â€)


____________________________________________________________`
    ].join('\n');

    // 3. URL ìƒì„±
    const baseUrl = "https://mail.worksmobile.com/write/popup";
    const recipient = "ë¬¸ì •ë™ì‚¬ì„œí•¨ <automedia@automediarentcar.com>";
    
    const mailUrl = `${baseUrl}?to=${encodeURIComponent(recipient)}&orderType=new&memo=false&subject=${encodeURIComponent(mailSubject)}&body=${encodeURIComponent(bodyTemplate)}`;

    // 4. ìƒˆ ì°½ ì—´ê¸°
    window.open(mailUrl, '_blank');
  }
