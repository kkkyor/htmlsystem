// ============================================================================
// [0] DOM 선택 헬퍼 (JQuery/Alpine 스타일 흉내)
// ============================================================================

// ID로 요소 선택 (가장 많이 사용됨)
const $ = (id) => document.getElementById(id);

// 값 안전하게 가져오기 (요소가 없어도 에러 안 나게)
const getVal = (id) => {
    const el = $(id);
    return el ? el.value : '';
};

// 값 안전하게 넣기
const setVal = (id, value) => {
    const el = $(id);
    if (!el) return;
    if (el.tagName === 'SPAN' || el.tagName === 'DIV') {
        el.textContent = value || '';
    } else {
        el.value = value || '';
    }
};

// 이벤트 리스너 단축
const on = (id, event, handler) => {
    const el = $(id);
    if (el) el.addEventListener(event, handler);
};

// ============================================================================
// [2] UI 및 유틸리티 함수
// ============================================================================

// [수정] 로딩창을 띄울 때마다 문구를 '처리 중...'으로 초기화
function showLoader() { 
    const el = document.getElementById('loader');
    const txt = document.querySelector('#loader p');
    
    // 매번 기본 문구로 리셋
    if(txt) txt.textContent = "처리 중...";
    
    if(el) el.classList.remove('hidden'); 
}

function hideLoader() { 
    const el = document.getElementById('loader');
    if(el) el.classList.add('hidden'); 
}

function escapeHtml(text) {
  if (text === null || text === undefined) return '';
  return String(text).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
}

function formatPhoneNumber_Client(phone) {
  if (!phone) return "";
  const digits = String(phone).replace(/\D/g, "");
  
  if (digits.length === 11) return `${digits.substring(0, 3)}-${digits.substring(3, 7)}-${digits.substring(7)}`;
  if (digits.length === 10) return `${digits.substring(0, 3)}-${digits.substring(3, 6)}-${digits.substring(6)}`;
  return phone;
}

function formatDate(isoString) {
  if (!isoString) return '';
  try {
    if (typeof isoString !== 'string') return String(isoString);
    return isoString.split('T')[0];
  } catch (e) {
    return isoString;
  }
} 

function showErrorModal(message) { alert(message); }

function handleFailure(error) {
  hideLoader();
  console.error(error);
  alert(`오류 발생: ${error.message || error}`);
}

function showSaveFeedback(btn) {
  if (!btn) return;
  const origin = btn.textContent;
  btn.textContent = "✅ 저장됨";
  btn.disabled = true;
  setTimeout(() => { 
      btn.textContent = origin; 
      btn.disabled = false; 
  }, 1500);
}

function getStatusClass(status) {
  // 상태별 색상 클래스 반환
  if (!status) return '';
  
  const successList = ['계약 완료', '출고 완료', '이용중', '상담 완료', '심사 완료'];
  if (successList.includes(status)) return 'success';
  
  const warningList = ['상담 진행 중', '연락 시도 중', '진행중', '견적 발송', '추가 정보 요청', '심사 진행중', '출고 대기'];
  if (warningList.includes(status)) return 'warning';
  
  const dangerList = ['취소', '중도 해지', '상담 이탈', '상담 보류', '조기 반납', '심사 부결', '취소/해지'];
  if (dangerList.includes(status)) return 'danger';
  
  const infoList = ['가망 고객', '심사 승인'];
  if (infoList.includes(status)) return 'info';
  
  const darkList = ['만기 반납', '만기 인계', '기존 고객', '배정됨'];
  if (darkList.includes(status)) return 'dark';

  return ''; 
}

// [헬퍼] 로딩 메시지 변경 (AI 분석 등에서 사용)
function setStatusMessage(msg) {
  const loaderText = document.querySelector('#loader p');
  if(loaderText) loaderText.textContent = msg;
}
