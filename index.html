<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>고객 상담일지 기록시스템</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700" rel="stylesheet">

  <style>
    /* ----------------------------------------------------------------- */
    /* ★ [핵심] 기본 레이아웃 설정 */
    /* ----------------------------------------------------------------- */
    body { 
      font-family: 'Arial', sans-serif; 
      line-height: 1.6; 
      margin: 0; 
      padding: 10px;
      background-color: #f4f4f4; 
      color: #333; 
      overflow: hidden; /* ★ 전체 페이지 스크롤 방지 */
    }
    
    .container { 
      max-width: 100%; /* 너비 꽉 채우기 */
      height: calc(100vh - 20px); /* 뷰포트 높이 꽉 채우기 */
      margin: 0;
      padding: 0;
      background: #fff; /* ★ [수정] 컨테이너에 흰색 배경 */
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      display: flex; /* ★ [수정] 내부 패널이 높이를 100% 채우도록 */
      flex-direction: column;
    }
    
    /* ★ [핵심] '목록 뷰'와 '상세 뷰'의 공통 스타일 */
    .list-panel, .detail-panel {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      display: flex; /* ★ [핵심] 2단 분할을 위해 Flex (가로 배치) */
      flex-direction: row;
      gap: 10px;
      padding: 15px;
    }

    h2 { color: #0056b3; border-bottom: 2px solid #eee; padding-bottom: 2px; margin-top: 0; margin-bottom: 3px;}
    
    h3 { 
      font-size: 1.15rem; /* H3 폰트 약간 축소 */
      margin-bottom: 10px;
      margin-top: 10px;
    }
    /* ----------------------------------------------------------------- */
    /* ★ [핵심] 뷰 1: 목록 화면 (List View) - 2단 분할 */
    /* ----------------------------------------------------------------- */
    
    /* 목록 뷰 - 좌측 패널 (필터 + ToDo) */
    .list-left-pane {
      flex: 0 0 350px; /* 좌측 너비 고정 */
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .filter-panel { 
      padding: 15px; 
      border: 1px solid #ddd; 
      border-radius: 5px; 
      background-color: #f9f9f9;
      flex-shrink: 0; /* 크기 고정 */
    }
    
    #todoListPanel {
      flex-grow: 1; /* 남은 공간 차지 */
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* 내부 스크롤을 위해 */
    }
    #todoCustomersList {
      list-style: none;
      padding: 0;
      margin: 0;
      overflow-y: auto; /* ★ ToDo 목록 내부 스크롤 */
      flex-grow: 1;
    }
    #todoCustomersList li { 
      padding: 10px; 
      background: #fdfdfd; 
      border-bottom: 1px solid #eee; 
      font-size: 0.95rem; 
      cursor: pointer;
      border-left: 3px solid #ffc107; /* ToDo 강조 */
    }
    #todoCustomersList li:hover { background-color: #fffbef; }

    /* 목록 뷰 - 우측 패널 (전체 목록) */
    .list-right-pane {
      flex: 1; /* 남은 공간 차지 */
      height: 100%;
      display: flex;
      flex-direction: column;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      box-sizing: border-box;
      overflow: hidden; /* 내부 스크롤을 위해 */
    }
    .list-header { flex-shrink: 0; }
    
    ul#assignedCustomersList { 
      list-style: none; 
      padding: 0; 
      margin: 0;
      flex-grow: 1; /* 목록(ul)이 남은 공간 차지 */
      overflow-y: auto; /* ★ 목록만 스크롤 */
      max-height: none; /* 기존 max-height 제거 */
    }
    li.active { background-color: #cce5ff; border-left: 3px solid #0056b3; font-weight: bold; }
    #assignedCustomersList li { 
      background: #f9f9f9; 
      margin-bottom: 6px; /* 여백 줄임 (10px -> 6px) */
      padding: 8px 12px; /* 패딩 줄임 (12px 15px -> 8px 12px) */
      border-radius: 5px; 
      cursor: pointer; 
      transition: background-color: 0.3s ease; 
      border-left: 4px solid transparent; 
      /* line-height: 1.5; */ /* 제거 */

      /* [신규] 1줄 플렉스 레이아웃 적용 */
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px; /* 자식 요소간 간격 */
      line-height: 1.3; /* 줄 높이 */
    }


    /* ----------------------------------------------------------------- */
    /* ★ [핵심] 뷰 2: 상세 화면 (Detail View) - 2단 분할 */
    /* ----------------------------------------------------------------- */
    
    /* 상세 뷰 - 좌측 패널 (고객 정보) */
    .detail-info-pane {
      flex: 1; /* 남은 공간 차지 */
      height: 100%;
      overflow-y: auto; /* ★ [핵심] 고객 정보 영역만 스크롤 */
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      box-sizing: border-box;
    }
    
    /* [신규] 요청 4: 단락 제목(h3) 색상 변경 */
    .detail-info-pane h3 {
      color: #0056b3; 
      margin-top: 0; /* [유지] 브라우저 기본 상단 마진 제거 */
      margin-bottom: 10px; /* [유지] 10px -> 5px (제목과 그리드 사이 간격) */
      /* ▼▼▼ [신규] Flex 컨테이너로 변경 ▼▼▼ */
      display: flex;
      align-items: center;
      /* ▲▲▲ [신규] ▲▲▲ */
    }
    /* 상세 뷰 - 우측 패널 (상담 기록) */
    .detail-log-pane {
      /* [수정] 요청 11: 너비 450px -> 600px */
      flex: 0 0 600px; 
      height: 100%;
      display: flex;
      flex-direction: column;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      box-sizing: border-box;
      background-color: #fdfdfd;
      overflow: hidden; /* 내부 스크롤을 위해 */
    }
    /* [신규] 요청 4: 단락 제목(h3) 색상 변경 */
    .detail-log-pane h3 {
      color: #0056b3; 
    }
    /* [신규] H3 제목 텍스트 뒤에 구분선 추가 */
.detail-info-pane h3::after {
  content: '';
  flex: 1; /* 남은 공간을 모두 채움 */
  height: 1px;
  background-color: #eee;
  margin-left: 10px; /* 제목과 선 사이 간격 */
  order: 1; /* [중요] 선을 1순위로 (텍스트 다음) */
}

/* [신규] H3 안의 버튼(예: '+ 신규 계약 추가')을 선 뒤로 이동 */
.detail-info-pane h3 > button {
  order: 2; /* [중요] 버튼을 2순위로 (선 다음) */
  flex-shrink: 0; /* 버튼이 찌그러지지 않게 함 */
}
    
    .detail-log-pane .log-entries {
      flex-grow: 1; /* 상담 목록이 남은 공간 차지 */
      overflow-y: auto; /* ★ [핵심] 상담 목록만 스크롤 */
      min-height: 200px;
      border: 1px solid #eee;
      padding: 10px;
      background-color: #fff;
      margin-bottom: 15px;
    }
    .log-entry { background: #f9f9f9; border-bottom: 1px solid #eee; padding: 10px; margin-bottom: 5px; font-size: 0.9rem; white-space: pre-wrap; }
    .log-entry:last-child { border-bottom: none; }
    .log-entry strong { color: #0056b3; margin-right: 10px; }
    
    .detail-log-pane .log-add-section {
      flex-shrink: 0; /* 크기 고정 */
    }
    .detail-log-pane .form-group { margin-top: 0; margin-bottom: 10px; }
    .detail-log-pane textarea { min-height: 120px; }

    /* ----------------------------------------------------------------- */
    /* 기타 유틸리티 및 공통 스타일 */
    /* ----------------------------------------------------------------- */
    .info-item { margin-bottom: 5px; display: flex; align-items: center; }
    .info-item strong { display: inline-block; width: 80px; color: #555; flex-shrink: 0; }
    .info-input { border: 1px solid #ccc; padding: 5px; border-radius: 4px; font-size: 1rem; }

    /* [삭제] 요청 8: .basic-info-grid CSS 삭제 */
    
    .back-link { display: inline-block; margin-bottom: 15px; color: #007bff; text-decoration: none; font-weight: bold; font-size: 1.05rem; }
    .back-link:hover { text-decoration: underline; }
    .form-group { margin-bottom: 8px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
    .form-group select, .form-group textarea, .form-group input { width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
    select.placeholder {
      color: #999 !important; /* 선택 안되었을 때 연한 회색 */
    }
    /* 드롭다운을 열었을 때 옵션들은 항상 진한 색으로 표시 */
    select option {
      color: #333;
    }
    .form-group textarea { resize: vertical; }
    button { background-color: #007bff; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95rem; transition: background-color: 0.3s ease; }
    button:hover { background-color: #0056b3; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }
    button.secondary { background-color: #6c757d; }
    button.secondary:hover { background-color: #5a6268; }
    
    /* [수정] 요청 13: 단락 간 여백(padding/margin) 8px로 축소 */
    .details-section { 
      margin-top: 15px;
      margin-bottom: 10px;
    }
    
    /* [수정] 요청 13: 그리드 항목 크기(300px) 고정, 여백(gap)은 고정하되, 항목 간 자동 배분(space-between) */
    .details-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, 300px); /* 300px 고정 크기 */
      gap: 8px 15px; 
      margin-top: 10px;
      margin-bottom: 5px; 
      justify-content: space-between; /* [핵심] 항목 사이의 여백을 자동으로 배분 */
    }
    
    /* ▼▼▼ [신규/수정] 그리드 내의 폼 그룹을 Flex(가로) 레이아웃으로 변경 ▼▼▼ */
    .details-grid .form-group {
      display: flex;
      flex-direction: row; /* 라벨과 입력을 가로로 배치 */
      align-items: center;
      gap: 8px;
      margin-bottom: 5; /* 그리드 갭이 여백을 대신함 */
    }
    
    /* [수정] 요청 10: .info-item (span 항목) 스타일 정의 */
    .details-grid .info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      /* padding: 6px 8px; */ /* [삭제] 래퍼 패딩 제거 (정렬 문제) */
      box-sizing: border-box; 
      min-height: 34px; 
    }
    .details-grid .info-item strong {
      flex: 0 0 90px; /* details-grid의 label 너비와 동일하게 */
      margin-bottom: 0;
      font-weight: bold;
      color: #555;
    }
    .details-grid .info-item span {
      flex: 1 1 auto;
      word-break: break-all; /* ID 등이 길 경우 */
      font-size: 1rem; /* input/select 글꼴 크기와 맞춤 */
      color: #333;
      /* [신규] 요청 10: input/select와 동일하게 패딩 추가 */
      padding: 6px 8px; 
      box-sizing: border-box;
      /* (선택) span도 input처럼 보이게 */
      /* background-color: #f4f4f4; */
      /* border: 1px solid #eee; */
      /* border-radius: 4px; */
    }
    
    
    /* ▼▼▼ [신규/수정] 그리드 내 폼 라벨의 너비 고정 ▼▼▼ */
    .details-grid .form-group label {
      flex: 0 0 90px; /* 항목 이름(라벨) 너비를 90px로 고정 */
      margin-bottom: 0;
      font-size: 0.9rem;
      font-weight: bold;
    }
    /* ▼▼▼ [신규/수정] 그리드 내 입력란이 남은 공간을 채우도록 변경 ▼▼▼ */
    .details-grid .form-group select,
    .details-grid .form-group input,
    .details-grid .form-group textarea {
      flex: 1 1 auto; /* 남은 공간을 모두 차지 */
      //width: auto; /* 기존 width: 100% 무효화 */
    }
    .contract-info { background-color: #e9f5ff; padding: 15px; border-radius: 5px; }
    .contract-info h3 { color: #004085; border-bottom-color: #b8daff; }
    
    /* [삭제] 요청 8: .contact-info-grid CSS 삭제 */
    
    .list-item-status { font-size: 0.9em; color: #555; }
    .filter-group { 
      display: grid; 
      grid-template-columns: 1fr 1fr; /* ★ 1열 -> 2열 그리드로 변경 */
      gap: 12px 8px; /* 세로 12px, 가로 8px */
    }
    .filter-panel .form-group label {
      font-size: 0.85rem; /* 라벨 폰트 약간 축소 */
      margin-bottom: 3px;
    }
    .filter-panel .form-group {
      margin-bottom: 0; /* 갭이 여백을 대신함 */
    }
    .filter-top-row { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
    .search-group { flex-basis: 100%; }
    .filter-actions { display: flex; gap: 10px; }
    .filter-actions button { flex: 1; }
    .filter-group select, 
    .filter-group input, 
    .search-group input { 
      width: 100%; 
      padding: 8px; /* ★ 10px -> 8px (높이 축소) */
      box-sizing: border-box; 
      font-size: 0.9rem; /* ★ 1rem -> 0.9rem (폰트 축소) */
      border: 1px solid #ccc; 
      border-radius: 4px; 
      font-family: 'Roboto', sans-serif; 
    }
    .filter-group .full-width {
      grid-column: 1 / -1;
    }
    .list-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; }
    .add-action-panel { display: flex; gap: 10px; }

    /* 모달, 로더, 상태 배지 */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 100001; display: flex; justify-content: center; align-items: center; }
    #loader { z-index: 100002; }
    .modal-content { background: #fff; padding: 25px; border-radius: 8px; width: 90%; max-width: 500px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .modal-actions { text-align: right; margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end; }
    .loader-content { display: flex; flex-direction: column; align-items: center; color: white; font-size: 1.2rem; }
    .spinner { border: 6px solid #f3f3f3; border-top: 6px solid #007bff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .status-badge { padding: 3px 8px; border-radius: 12px; font-size: 0.85em; font-weight: bold; color: #333; background-color: #e0e0e0; }
    .status-badge.consulting { background-color: #fff3cd; color: #664d03; }
    .status-badge.completed { background-color: #d1e7dd; color: #0f5132; }
    .status-badge.contracted { background-color: #cce5ff; color: #004085; border: 1px solid #0056b3; }
    .status-badge.failed { background-color: #f8d7da; color: #58151c; }
    /* [신규] '고객 정보 저장' 버튼 상단 여백 및 우측 정렬 */
    #saveCustomerDetailsBtn {
      display: block;       /* [추가] 버튼을 블록 요소로 만듦 */
      margin-left: auto;    /* [추가] 왼쪽 마진을 자동으로 밀어내어 우측 정렬 */
      margin-right: 10px;      /* [추가] 오른쪽 마진은 0으로 고정 */
      margin-top: 5px;      /* [유지] 상단 여백 */
      margin-bottom: 10px;
    }
    /* ★ [핵심] hidden 클래스 로직 (패널 전환 및 모달용) */
    .hidden,
    #loader.hidden, 
    #addCustomerModal.hidden,
    #addContractModal.hidden, /* [신규] Task 6 */
    #contractInfoSection.hidden,
    #customerInfoGroup.hidden { 
      display: none !important; 
    }
    
    .error-modal-content { background: #fff; padding: 25px; border-radius: 8px; width: 90%; max-width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .error-modal-content h3 { color: #dc3545; margin-top: 0; border-bottom: 2px solid #eee; }
    .error-modal-content p { margin: 20px 0; font-size: 1.1rem; }
    .error-modal-btn { background-color: #dc3545 !important; color: white; width: 100%; }
    .error-modal-btn:hover { background-color: #c82333 !important; }

    /* 반응형 (화면이 좁아지면 2단 분할을 세로로 쌓음) */
    @media (max-width: 1200px) {
      .list-panel, .detail-panel {
        flex-direction: column;
        overflow-y: auto; /* 패널 자체가 스크롤되도록 */
        height: auto; 
      }
      .list-left-pane, .list-right-pane,
      .detail-info-pane, .detail-log-pane {
        flex-basis: auto; 
        width: 100%;
        height: auto; 
        overflow-y: visible; /* 내부 스크롤 제거 */
      }
      ul#assignedCustomersList, #todoCustomersList {
        max-height: 50vh; 
        overflow-y: auto;
      }
      .detail-log-pane .log-entries {
        max-height: 40vh; 
        overflow-y: auto;
      }
      /* [신규] 반응형일 때 contact-info-grid 2열로 변경 */
      /* [수정] .contact-info-grid -> .details-grid */
      .details-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        /* [수정] 요청 13: 반응형에서는 space-between 대신 기본(stretch)으로 */
        justify-content: stretch; 
      }
    }

    /* 스켈레톤, 플래시 등 */
    .skeleton-li { background: #f9f9f9; margin-bottom: 10px; padding: 12px 15px; border-radius: 5px; border-left: 4px solid transparent; line-height: 1.5; }
    .skeleton-item { background: linear-gradient(90deg, #eee 25%, #e0e0e0 50%, #eee 75%); background-size: 200% 100%; animation: skeleton-shine 1.5s infinite linear; border-radius: 4px; }
    .skeleton-li .line-1 { height: 1.15em; width: 40%; margin-bottom: 8px; }
    .skeleton-li .line-2 { height: 0.95em; width: 60%; margin-bottom: 8px; }
    .skeleton-li .line-3 { height: 0.9em; width: 30%; border-top: 1px solid #eee; padding-top: 8px; }
    @keyframes skeleton-shine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .flash-success { animation: flash-green 1s ease-out; }
    @keyframes flash-green { 0% { background-color: #d4edda; } 100% { background-color: #f9f9f9; } }
    .form-group-inline label { margin-bottom: 3px; }
    .input-button-group { display: flex; align-items: center; gap: 8px; }
    
    /* [수정] 요청 1: '번호 저장' 버튼 높이 수정 */
    .input-button-group button {
       padding: 6px 12px; /* [수정] 8px -> 6px (input과 동일하게) */
       font-size: 0.9rem;
       height: auto; 
       min-height: 0;
       line-height: 1.2; 
       flex-shrink: 0; /* [신규] 요청 9: 버튼 너비 축소 방지 */
    }
    .input-button-group input {
      height: auto;
      min-height: 0;
      padding: 6px 8px; 
      font-size: 0.9rem;
    }
    
    .detail-info-pane .details-section:first-child .form-group,
    .detail-info-pane .details-section:first-child .form-group-inline { max-width: 450px; }
    .details-section h3 { display: flex; justify-content: space-between; align-items: center; }
    .toggle-section-btn { font-size: 0.85rem; padding: 3px 10px; background-color: #6c757d; min-height: auto; height: auto; line-height: 1.5; }
    .toggle-section-btn:hover { background-color: #5a6268; }

    /* [삭제] 요청 13: 이전의 잘못된 :first-child 규칙 삭제 */

    /* [수정] 요청 13: 숨겨진 단락들의 여백을 줄이고 선(border-top)은 유지 */
    #customerInfoGroup > .details-section {
      margin-top: 8px; /* 10px -> 8px */
      padding-top: 4px; /* 10px -> 8px */
      margin-bottom: 10px;
    }

    /* [신규] 1줄 리스트 아이템 스타일 */
    .li-item {
      white-space: nowrap; /* 줄바꿈 방지 */
      overflow: hidden; /* 넘침 숨기기 */
      text-overflow: ellipsis; /* ... 처리 */
    }

    /* ▼▼▼ [신규] DB 유형 스타일 추가 ▼▼▼ */
    .li-item.dbtype {
      flex: 0 0 80px;  /* 80px 고정 너비 (DB 유형용) */
      color: #666;
      font-weight: bold;
      font-size: 0.9em;
    }
    /* ▲▲▲ [신규] ▲▲▲ */

    .li-item.status {
      flex: 0 0 100px; /* 100px 고정 (상태 배지) */
    }
    .li-item.name {
      /* ▼▼▼ [수정] flex: 1 1 120px -> 0 1 120px (공간 확장 방지) ▼▼▼ */
      flex: 0 1 120px; 
      font-weight: bold;
      color: #004085;
      font-size: 1.05em;
    }
    .li-item.phone {
      flex: 0 0 120px; /* 120px 고정 (전화번호) */
      color: #333;
      font-size: 0.95em;
    }
    /* ▼▼▼ [수정] .model -> .memo 로 클래스명 변경 ▼▼▼ */
    .li-item.memo {
      flex: 1 1 100px; /* 100px 기본, 남은 공간 모두 차지 */
      color: #444;
      font-size: 0.95em;
    }
    /* ▲▲▲ [수정] ▲▲▲ */

    .li-item.log {
      /* ▼▼▼ [수정] flex: 0 1 150px -> 1 1 150px (남은 공간 모두 차지) ▼▼▼ */
      flex: 0 1 150px; 
      color: #0056b3;
      font-size: 0.9em;
    }

    /* ▼▼▼ [수정] DB유형이 분리되었으므로 너비 축소 ▼▼▼ */
    .li-item.date {
      flex: 0 0 90px; /* 90px 고정 (110px -> 90px) */
      font-size: 0.9em;
      color: #555;
      text-align: right;
    }
    /* ▲▲▲ [수정] ▲▲▲ */
  </style>
</head>
<body data-view="<?= view ?>" data-is-dual-mode="false" data-script-url="<?= scriptUrl ?>">

  <div id="loader" class="modal-overlay hidden" role="alert" aria-live="assertive">
    <div class="loader-content"><div class="spinner"></div><p>처리 중입니다...</p></div>
  </div>
  
  <div id="addCustomerModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h2>신규 고객 추가</h2>
      <div class="form-group"><label for="newDbType">디비 유형:</label><select id="newDbType"></select></div>
      <div class="form-group"><label for="newCustomerName">고객명:</label><input type="text" id="newCustomerName" placeholder="고객명을 입력하세요 (필수)"></div>
      <div class="form-group"><label for="newCustomerPhoneNumber">고객 전화번호:</label><input type="tel" id="newCustomerPhoneNumber" placeholder="숫자 또는 '-'를 포함하여 입력"></div>
      <div class="modal-actions"><button id="cancelAddCustomerBtn" class="secondary">취소</button><button id="saveNewCustomerBtn">저장</button></div>
    </div>
  </div>

  <div id="addContractModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h2>신규 계약 추가</h2>
      
      <div class="form-group">
        <label for="modalContractDate">계약 체결일:</label>
        <input type="date" id="modalContractDate">
      </div>
      <div class="form-group">
        <label for="modalContractCarModel">계약 차종:</label>
        <input type="text" id="modalContractCarModel" placeholder="예: K5 2.0 LPI">
      </div>
      <div class="form-group">
        <label for="modalContractAmount">월 렌탈료 (숫자만):</label>
        <input type="number" id="modalContractAmount" placeholder="예: 550000">
      </div>
      <div class="form-group">
        <label for="modalContractTerm">계약 기간 (개월):</label>
        <input type="text" id="modalContractTerm" placeholder="예: 48개월">
      </div>
      <!--> <div class="form-group">
        <label for="modalContractStatus">계약 상태:</label>
        <select id="modalContractStatus">
          <option value="심사중">심사중</option>
          <option value="진행중">진행중</option>
          <option value="만료">만료</option>
          <option value="중도해지">중도해지</option>
        </select>
      </div>
      <-->
      <div class="form-group">
        <label for="modalContractSummary">계약 특이사항 메모:</label>
        <textarea id="modalContractSummary" rows="3"></textarea>
      </div>
      
      <div class="modal-actions">
        <button id="cancelAddContractBtn" class="secondary">취소</button>
        <button id="saveNewContractBtn">계약 저장</button>
      </div>
    </div>
  </div>
  <div class="container">
        
    <div class="list-panel" id="listPanel">
      
      <div class="list-left-pane">
        <div class="filter-panel">
          <h3>빠른 검색 및 필터</h3>
          <div class="filter-top-row">
            <div class="search-group">
              <label for="filterSearchTerm">통합 검색:</label>
              <input type="text" id="filterSearchTerm" placeholder="검색어 입력...">
            </div>
            <div class="filter-actions">
              <button id="resetFilterBtn" class="secondary">초기화</button>
              <button id="applyFilterBtn">검색</button>
            </div>
          </div>
          <div class="filter-group">

            <div class="form-group">
              <label for="filterDbType">디비 유형:</label>
              <select id="filterDbType"><option value="">전체</option></select>
            </div>
            <div class="form-group">
              <label for="filterCustomerStatus">상담 상태:</label>
              <select id="filterCustomerStatus"><option value="">전체</option><option value="배정됨">배정됨</option><option value="연락 시도 중">연락 시도 중</option><option value="상담 진행 중">상담 진행 중</option><option value="추가 정보 요청">추가 정보 요청</option><option value="상담 완료">상담 완료</option></select>
            </div>

            <div class="form-group">
              <label for="filterAssignmentDateFrom">배정일 시작:</label>
              <input type="date" id="filterAssignmentDateFrom">
            </div>
            <div class="form-group">
              <label for="filterAssignmentDateTo">배정일 종료:</label>
              <input type="date" id="filterAssignmentDateTo">
            </div>

            <div class="form-group" style="border-top: 1px dashed #ccc; padding-top: 12px; margin-top: 2px;">
              <label for="filterLastLogDateFrom">마지막 상담일 시작:</label>
              <input type="date" id="filterLastLogDateFrom">
            </div>
            <div class="form-group" style="border-top: 1px dashed #ccc; padding-top: 12px; margin-top: 2px;">
              <label for="filterLastLogDateTo">마지막 상담일 종료:</label>
              <input type="date" id="filterLastLogDateTo">
            </div>
            
            <!-->
            <div class="form-group">
              <label for="filterContractStatus">계약 상태:</label>
              <select id="filterContractStatus"><option value="">전체</option><option value="미해당">미해당</option><option value="계약 제안">계약 제안</option><option value="협상 중">협상 중</option><option value="계약 체결">계약 체결</option><option value="계약 무산">계약 무산</option><option value="계약 종료">계약 종료</option></select>
            </div>
            <-->

          </div>
        </div>
        
        <div id="todoListPanel">
          <h3>상담 전 고객 (To-Do)</h3>
          <ul id="todoCustomersList">
            <li>(기능 구현 예정)</li>
            </ul>
        </div>
      </div>
      
      <div class="list-right-pane">
        <div class="list-header">
          <h2>전체 고객 목록 (검색 결과)</h2>
          <div class="add-action-panel">
            <button id="openAddCustomerModalBtn">+ 신규 고객 추가</button>
          </div>
        </div>
        
        <ul id="assignedCustomersList"><li>로딩 중...</li></ul>
        
        <div style="text-align: center; margin-top: 10px; flex-shrink: 0;">
          <button id="loadMoreBtn" class="secondary hidden">+ 더보기</button>
        </div>
      </div>
      
    </div>
    
    <div class="detail-panel hidden" id="customerDetailPanel">
      
      <div class="detail-info-pane">
        <a href="#" id="backToListBtn" class="back-link">&larr; 목록으로 돌아가기</a>
        
        <h2 id="detailCustomerName" style="display: flex; justify-content: space-between; align-items: center;">
          <span id="detailCustomerNameText">고객 상세 정보</span> <button id="toggleCustomerInfoBtn" class="toggle-section-btn secondary">상세 정보 숨기기</button>
        </h2>
        
        <div id="assignmentDetails"> 
        
          <div class="details-section" style="border-top: none; margin-top: 0; padding-top: 0;">
            <!--><h3>고객 기본 정보</h3><--> 
            
            <div class="details-grid"> 
              
              <div class="info-item">
                <strong>배정 ID:</strong> <span id="detailAssignmentId"></span>
              </div>
              <div class="info-item">
                <strong>DB 유형:</strong> <span id="detailDbType"></span>
              </div>
              <div class="info-item">
                <strong>배정일:</strong> <span id="detailAssignmentDate"></span>
              </div>
              
              <div class="form-group">
                <label for="leadSource">유입 경로:</label>
                <select id="leadSource"> <option value="">-- 선택 --</option>
                </select>
              </div>

              <div class="form-group">
                <label for="detailCustomerPhoneNumber">연락처:</label>
                <div class="input-button-group">
                  <input type="tel" id="detailCustomerPhoneNumber"> 
                  <button id="savePhoneNumberBtn">저장</button>
                </div>
              </div>

              <div class="form-group">
                <label for="customerStatus">고객 상태:</label>
                <select id="customerStatus"><option value="">-- 선택 --</option></select> 
              </div>
              
              <div class="form-group">
                <label for="customerMemo">고객 메모:</label>
                <input type="text" id="customerMemo" placeholder="목록에 표시될 간단한 메모...">
              </div>

              <div class="form-group">
                <label for="quoteNumber">견적번호:</label>
                <input type="text" id="quoteNumber" placeholder="견적번호 입력...">
              </div>
              
              <div class="form-group">
                <label for="approvalNumber">승인번호:</label>
                <input type="text" id="approvalNumber" placeholder="승인번호 입력...">
              </div>

            </div> </div>
          
          <div id="customerInfoGroup">
            <div class="details-section"> 
              <h3>고객 상세 정보 </h3> 
              <div class="details-grid"> 
                <div class="form-group">
                  <label for="customerType">고객 유형:</label>
                  <select id="customerType"><option value="">-- 선택 --</option><option value="개인">개인</option><option value="개인사업자">개인사업자</option><option value="법인">법인</option></select>
                </div>
                <div class="form-group">
                  <label for="gender">성별:</label>
                  <select id="gender"><option value="">-- 선택 --</option><option value="남성">남성</option><option value="여성">여성</option></select>
                </div>
                <div class="form-group">
                  <label for="ageGroup">연령대:</label>
                  <select id="ageGroup"><option value="">-- 선택 --</option></select> 
                </div>
                <div class="form-group">
                  <label for="addressCity">주소 (시/도):</label>
                  <select id="addressCity"><option value="">-- 선택 --</option></select> 
                </div>
                <div class="form-group">
                  <label for="detailAddress">상세 지역:</label>
                  <input type="text" id="detailAddress" placeholder="예: 강남구 역삼동">
                </div>
                <div class="form-group">
                  <label for="incomeType">직업:</label>
                  <select id="incomeType"><option value="">-- 선택 --</option></select> 
                </div>
                <div class="form-group">
                  <label for="occupation">직종:</label>
                  <input type="text" id="occupation" placeholder="예: 제조업, IT개발">
                </div>
                <div class="form-group">
                  <label for="creditInfo">신용등급:</label>
                  <select id="creditInfo"><option value="">-- 선택 --</option></select> 
                </div>
              </div> 
            </div>
            <div class="details-section">
              <h3>고객 니즈</h3>
              <div class="details-grid">
                <div class="form-group"><label for="interestedCarModel">관심 차종:</label><input type="text" id="interestedCarModel"></div>
                <div class="form-group"><label for="comparisonCarModel">비교 차량:</label><input type="text" id="comparisonCarModel"></div>
                <div class="form-group"><label for="ownedCarModel">보유 차량:</label><input type="text" id="ownedCarModel"></div>
                <div class="form-group">
                  <label for="carUsage">차량 용도:</label>
                  <select id="carUsage"><option value="">-- 선택 --</option></select> </div>
                <div class="form-group">
                    <label for="drivingDistance">주행 거리:</label>
                    <select id="drivingDistance"><option value="">-- 선택 --</option></select>
                  </div>
                 <div class="form-group">
                  <label for="driverScope">운전자 범위:</label> <input type="text" id="driverScope" placeholder="예: 누구나">
                </div>
              </div>
            </div>
            <div class="details-section">
              <h3>희망 계약 조건</h3>
              <div class="details-grid">
                <div class="form-group">
                  <label for="expectedContractTiming">필요 시기:</label>
                  <select id="expectedContractTiming"><option value="">-- 선택 --</option></select> </div>
                <div class="form-group">
                  <label for="desiredContractTerm">계약 기간:</label>
                  <select id="desiredContractTerm"><option value="">-- 선택 --</option></select> </div>
                <div class="form-group">
                  <label for="desiredInitialCostType">초기 비용:</label>
                  <select id="desiredInitialCostType"><option value="">-- 선택 --</option></select> </div>
                <div class="form-group">
                  <label for="maintenanceServiceLevel">정비 서비스:</label>
                  <select id="maintenanceServiceLevel"><option value="">-- 선택 --</option></select> </div>
                <!--><div class="form-group"><label for="salesCondition">판매 조건:</label><input type="text" id="salesCondition"></div><-->
                <div class="form-group">
                  <label for="isRepurchase">재구매 여부:</label>
                  <select id="isRepurchase"><option value="">-- 선택 --</option><option value="Y">Y</option><option value="N">N</option></select>
                </div>
                <div class="form-group"><label for="paymentMethod">결제 방식:</label><input type="text" id="paymentMethod" placeholder="예: 현금, 카드"></div> </div>
            </div>
          </div>

          <div class="details-section">
              <button id="saveCustomerDetailsBtn" style="margin-top: 5px; margin-bottom: 5px;">고객 정보 저장</button>
          </div>
          
          <div class="details-section contract-history-section" style="background-color: #f9f9f9; padding: 15px; border-radius: 5px;">
            <h3 style="display: flex; justify-content: space-between; align-items: center;">
              계약 이력
              <button id="openAddContractModalBtn" class="secondary" style="font-size: 0.9rem; padding: 5px 10px; min-height: auto; height: auto; line-height: 1.5;">+ 신규 계약 추가</button>
            </h3>
            <ul id="contractList" style="list-style: none; padding: 0; margin-top: 10px; max-height: 300px; overflow-y: auto; border-top: 1px solid #eee;">
              <li style="padding: 10px; text-align: center; color: #777;">(계약 이력이 없습니다.)</li>
            </ul>
          </div>

          </div>
      </div>
        
      <div class="detail-log-pane">
        <h3>상담 상세 기록</h3>
        
        <div class="log-entries" id="consultationLogs">
          <p style="padding: 20px; text-align: center; color: #777; margin-top: 30px;">
            고객을 선택하면 상담 기록이 표시됩니다.
          </p>
        </div>
        
        <div class="log-add-section">
          <h3>새 상담 기록 추가</h3>
          <div class="form-group">
            <textarea id="newLogContent" placeholder="상담 내용을 입력하세요..." spellcheck="false"></textarea>
          </div>
          <button id="addLogBtn" style="width: 100%;">기록 추가</button>
        </div>
      </div>

    </div>
  </div> <script>
  <?!= HtmlService.createTemplateFromFile('JavaScript').getRawContent() ?>
</script>
</body>
</html>
